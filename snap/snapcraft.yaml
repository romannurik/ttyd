name: ttyd
adopt-info: ttyd
summary: Share your terminal over the web
description: |
 ttyd is a simple command-line tool for sharing terminal over the web

grade: stable
confinement: strict
base: core20
compression: lzo

license: MIT

assumes:
  - command-chain

apps:
  ttyd:
    command: bin/ttyd
    command-chain: 
      - bin/homeishome-launch       
    plugs:
      - network
      - network-observe
      - home

parts:
  ttyd:
    source: https://github.com/tsl0922/ttyd
    source-type: git
    plugin: nil
    override-build: |
      git clone https://github.com/tsl0922/ttyd.git
      cd ttyd && mkdir build && cd build
      cmake ..
      make && sudo make install
      mkdir -p $SNAPCRAFT_PART_INSTALL/bin/  
      cp ttyd $SNAPCRAFT_PART_INSTALL/bin/
      
    override-pull: |
      snapcraftctl pull
      snapcraftctl set-version "$(git describe --tags | sed 's/^v//' | cut -d "-" -f1)"
      
    build-packages:
      - build-essential 
      - libjson-c-dev 
      - libwebsockets-dev
      - cmake
      - extra-cmake-modules
      - git
      - gcc-10
      
    stage-packages:
      - build-essential 
      - libjson-c-dev 
      - libwebsockets-dev
      
  homeishome-launch:
    plugin: nil
    stage-snaps:
      - homeishome-launch  
